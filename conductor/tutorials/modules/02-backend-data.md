# ğŸ—„ï¸ Module 2: å¾Œç«¯é–‹ç™¼ - API èˆ‡ Prisma è³‡æ–™åº«

åšç¶²ç«™ä¸åªæ˜¯ç•«ç•«é¢ï¼Œæˆ‘å€‘é‚„éœ€è¦å­˜è³‡æ–™ã€‚é€™ç« æ•™ä½ å¦‚ä½•è·Ÿè³‡æ–™åº«æºé€šï¼Œä»¥åŠæ€éº¼å¯« APIã€‚

## 1. ä»€éº¼æ˜¯ API (Application Programming Interface)ï¼Ÿ

API å°±åƒæ˜¯**é¤å»³çš„æœå‹™ç”Ÿ**ã€‚
*   **ä½  (å‰ç«¯/ç€è¦½å™¨)** æ‹¿è‘—èœå–®è·Ÿæœå‹™ç”Ÿé»é¤ï¼šã€Œæˆ‘è¦ä¸€ä»½æŠ€èƒ½åˆ—è¡¨ (GET /api/skills)ã€ã€‚
*   **æœå‹™ç”Ÿ (API)** æŠŠå–®å­æ‹¿é€²å»šæˆ¿ã€‚
*   **å»šæˆ¿ (è³‡æ–™åº«)** æŠŠè³‡æ–™æ’ˆå‡ºä¾†ï¼Œç‚’ä¸€ç‚’ã€‚
*   **æœå‹™ç”Ÿ (API)** æŠŠçµæœ (JSON) ç«¯å‡ºä¾†çµ¦ä½ ã€‚

### åœ¨ Next.js è£¡å¯« API
åªè¦åœ¨ `src/app/api` è³‡æ–™å¤¾ä¸‹å»ºç«‹ `route.ts`ï¼Œå®ƒå°±è®Šæˆä¸€å€‹æœå‹™ç”Ÿäº†ã€‚

```ts
// src/app/api/hello/route.ts
import { NextResponse } from "next/server";

export async function GET() {
  return NextResponse.json({ message: "ä½ å¥½ï¼Œæˆ‘æ˜¯æœå‹™ç”Ÿï¼" });
}
```
ç¾åœ¨ä½ åªè¦è¨ªå• `http://localhost:3000/api/hello`ï¼Œå°±æœƒæ”¶åˆ°é€™å‰‡è¨Šæ¯ã€‚

---

## 2. Prismaï¼šè³‡æ–™åº«çš„ç¿»è­¯å®˜

æˆ‘å€‘ç”¨çš„æ˜¯ **PostgreSQL** è³‡æ–™åº«ï¼Œå®ƒåªè½å¾—æ‡‚ä¸€ç¨®å« **SQL** çš„èªè¨€ (`SELECT * FROM users...`)ã€‚
è¦å­¸ SQL æœ‰é»ç´¯ï¼Œæ‰€ä»¥æˆ‘å€‘è«‹äº†ä¸€å€‹ç¿»è­¯å®˜ï¼š**Prisma**ã€‚

### æ­¥é©Ÿ 1ï¼šå®šç¾©è³‡æ–™çµæ§‹ (Schema)
æˆ‘å€‘åœ¨ `prisma/schema.prisma` æª”æ¡ˆè£¡ç•«è—åœ–ã€‚

```prisma
// å˜¿ Prismaï¼Œæˆ‘çš„è³‡æ–™åº«è¦æœ‰å€‹ã€Œä½¿ç”¨è€…ã€è¡¨
model User {
  id    String @id @default(cuid()) // è‡ªå‹•ç”¢ç”Ÿçš„ ID
  email String @unique              // Email ä¸èƒ½é‡è¤‡
  name  String?                     // åå­— (å¯æœ‰å¯ç„¡)
}
```

### æ­¥é©Ÿ 2ï¼šæ“ä½œè³‡æ–™åº« (Client)
åœ¨ç¨‹å¼ç¢¼ (`route.ts` æˆ– Server Component) è£¡ï¼Œæˆ‘å€‘å¯ä»¥é€™æ¨£å¯«ï¼š

*   **æ‰¾å…¨éƒ¨çš„äºº**ï¼š`prisma.user.findMany()` 
    *   *(Prisma æœƒå¹«ä½ ç¿»æˆ: `SELECT * FROM User`)*
*   **æ–°å¢ä¸€å€‹äºº**ï¼š`prisma.user.create({ data: { name: "Alice", email: "a@test.com" } })`
    *   *(Prisma æœƒå¹«ä½ ç¿»æˆ: `INSERT INTO User...`)*

æ˜¯ä¸æ˜¯è·Ÿå¯« JavaScript ä¸€æ¨£ç°¡å–®ï¼Ÿå®Œå…¨ä¸ç”¨èƒŒ SQL æŒ‡ä»¤ï¼

---

## 3. å¯¦æˆ°ï¼šSkill Browser çš„è³‡æ–™åº«è¨­è¨ˆ

æˆ‘å€‘çš„å°ˆæ¡ˆæœ‰ä¸‰å€‹æœ€é‡è¦çš„è¡¨ï¼ˆTableï¼‰ï¼š

1.  **User (ä½¿ç”¨è€…)**ï¼šå­˜å“¡å·¥è³‡æ–™ã€Git Tokenã€‚
2.  **Skill (æŠ€èƒ½)**ï¼šå­˜æŠ€èƒ½åç¨±ã€æè¿°ã€ä¸‹è¼‰æ¬¡æ•¸ã€‚
    *   ä¸€å€‹ä½¿ç”¨è€…å¯ä»¥æ“æœ‰(Own)å¾ˆå¤šæŠ€èƒ½ã€‚
3.  **SkillVersion (ç‰ˆæœ¬)**ï¼šå­˜æ¯æ¬¡æ›´æ–°çš„ commit hash å’Œ READMEã€‚
    *   ä¸€å€‹æŠ€èƒ½å¯ä»¥æœ‰å¾ˆå¤šæ­·å²ç‰ˆæœ¬ã€‚

### é—œè¯åœ– (Relationship)
`User` --(æ“æœ‰)--> `Skills` --(åŒ…å«)--> `Versions`

ç•¶æˆ‘å€‘è¦æ‰¾ã€ŒæŸå€‹æŠ€èƒ½çš„æœ€æ–°ç‰ˆæœ¬ã€æ™‚ï¼ŒPrisma å¯ä»¥å¹«æˆ‘å€‘ä¸€æ¬¡æ’ˆå‡ºä¾† (é€™å« Join)ï¼š

```ts
const skill = await prisma.skill.findUnique({
  where: { id: "skill-123" },
  include: { versions: true } // <-- é­”æ³•å’’èªï¼šé †ä¾¿å¹«æˆ‘æŠŠç‰ˆæœ¬ä¹Ÿæ‹¿å‡ºä¾†ï¼
});
```

---

## âœ… æœ¬ç« ä½œæ¥­ (Homework)
1.  **é–±è®€è—åœ–**ï¼šæ‰“é–‹ `prisma/schema.prisma`ï¼Œçœ‹çœ‹æˆ‘å€‘çš„è³‡æ–™åº«åˆ°åº•é•·ä»€éº¼æ¨£å­ï¼Œè©¦è‘—æ‰¾å‡º `Skill` è¡¨æœ‰å“ªäº›æ¬„ä½ã€‚
2.  **ç•¶å€‹é§­å®¢**ï¼š
    *   åœ¨ VS Code çµ‚ç«¯æ©Ÿè¼¸å…¥ `npx prisma studio`ã€‚
    *   ç€è¦½å™¨æœƒè·³å‡ºä¸€å€‹è¦–çª— (Prisma Studio)ã€‚
    *   é€™å°±æ˜¯è³‡æ–™åº«çš„ç®¡ç†å¾Œå°ï¼ä½ å¯ä»¥è©¦è‘—é»å…©ä¸‹ `downloadCount` æŠŠæ•¸å­—æ”¹å¤§ï¼Œç„¶å¾Œå›åˆ°ç¶²ç«™é‡æ–°æ•´ç†ï¼Œçœ‹çœ‹ä¸‹è¼‰æ•¸æ˜¯ä¸æ˜¯è®Šäº†ï¼Ÿ
