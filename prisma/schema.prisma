// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  image         String?
  provider      String    // e.g., "github" or "gitlab"
  gitToken      String?   // 儲存加密後的 Git Token
  useUserKey    Boolean   @default(false) // 是否啟用使用者自訂金鑰加密
  skills        Skill[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Skill {
  id            String         @id @default(cuid())
  name          String         @unique
  description   String
  descriptionZH String?        // 新增中文說明欄位
  repoUrl       String
    category      String
    tags          String[]
    downloadCount Int            @default(0) // 新增下載次數
    ownerId       String
    owner         User           @relation(fields: [ownerId], references: [id])
  versions    SkillVersion[]
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  @@index([category])
  @@index([ownerId])
}

model SkillVersion {
  id             String   @id @default(cuid())
  version        String   // SemVer e.g., "1.0.0"
  commitHash     String
  readmeContent  String   @db.Text
  readmeContentZH String?  @db.Text // 新增中文版欄位
  metadata       Json     // Stores metadata.json snapshot
  securityStatus String   @default("safe") // "safe" | "warn"
  skillId        String
  skill          Skill    @relation(fields: [skillId], references: [id], onDelete: Cascade)
  createdAt      DateTime @default(now())

  @@unique([skillId, version])
  @@index([skillId])
}
